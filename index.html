<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tanks 2 Player</title>
    <style>
        body { margin: 0; background: #222; overflow: hidden; font-family: sans-serif; touch-action: none; }
        canvas { display: block; background: #000; margin: 0 auto; border: 4px solid #444; }
        .controls { position: absolute; width: 100%; height: 100%; pointer-events: none; }
        .btn { position: absolute; width: 80px; height: 80px; background: rgba(255,255,255,0.2); 
               border-radius: 50%; pointer-events: auto; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        /* Игрок 1 (Зеленый) - Слева */
        #p1-up { bottom: 120px; left: 100px; }
        #p1-down { bottom: 20px; left: 100px; }
        #p1-fire { bottom: 70px; left: 200px; background: rgba(0,255,0,0.3); }
        /* Игрок 2 (Красный) - Справа */
        #p2-up { top: 20px; right: 100px; }
        #p2-down { top: 120px; right: 100px; }
        #p2-fire { top: 70px; right: 200px; background: rgba(255,0,0,0.3); }
    </style>
</head>
<body>
    <canvas id="game"></canvas>
    <div class="controls">
        <div class="btn" id="p1-up">↑</div><div class="btn" id="p1-down">↓</div><div class="btn" id="p1-fire">ОГОНЬ</div>
        <div class="btn" id="p2-up">↓</div><div class="btn" id="p2-down">↑</div><div class="btn" id="p2-fire">ОГОНЬ</div>
    </div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let tanks = [
    { x: 100, y: canvas.height/2, color: 'green', angle: 0, score: 0 },
    { x: canvas.width-100, y: canvas.height/2, color: 'red', angle: Math.PI, score: 0 }
];
let bullets = [];

function draw() {
    ctx.fillStyle = 'black';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    tanks.forEach(t => {
        ctx.save();
        ctx.translate(t.x, t.y);
        ctx.rotate(t.angle);
        ctx.fillStyle = t.color;
        ctx.fillRect(-20, -15, 40, 30);
        ctx.fillStyle = 'gray';
        ctx.fillRect(0, -4, 30, 8);
        ctx.restore();
    });

    bullets.forEach((b, i) => {
        b.x += Math.cos(b.angle) * 7;
        b.y += Math.sin(b.angle) * 7;
        ctx.fillStyle = 'yellow';
        ctx.beginPath();
        ctx.arc(b.x, b.y, 4, 0, Math.PI*2);
        ctx.fill();

        tanks.forEach((t, ti) => {
            if(Math.hypot(b.x-t.x, b.y-t.y) < 25) {
                tanks[ti === 0 ? 1 : 0].score++;
                t.x = ti === 0 ? 100 : canvas.width-100;
                t.y = canvas.height/2;
                bullets.splice(i, 1);
            }
        });
    });

    ctx.fillStyle = 'white';
    ctx.font = '20px Arial';
    ctx.fillText(`Зеленый: ${tanks[0].score}`, 20, 30);
    ctx.fillText(`Красный: ${tanks[1].score}`, canvas.width-150, 30);
    requestAnimationFrame(draw);
}

function move(ti, dir) {
    tanks[ti].x += Math.cos(tanks[ti].angle) * dir * 5;
    tanks[ti].y += Math.sin(tanks[ti].angle) * dir * 5;
}

function fire(ti) {
    bullets.push({ x: tanks[ti].x, y: tanks[ti].y, angle: tanks[ti].angle });
}

// Управление касанием
const setupBtn = (id, fn) => document.getElementById(id).addEventListener('touchstart', (e) => { e.preventDefault(); fn(); });
setupBtn('p1-up', () => move(0, 1));
setupBtn('p1-down', () => move(0, -1));
setupBtn('p1-fire', () => fire(0));
setupBtn('p2-up', () => move(1, 1));
setupBtn('p2-down', () => move(1, -1));
setupBtn('p2-fire', () => fire(1));

draw();
</script>
</body>
</html>
