<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ТАНКИ: СТАЛЬНАЯ ДЕТАЛИЗАЦИЯ (ГЕН-18)</title>
    <style>
        body { margin: 0; background: #0a0a0a; overflow: hidden; touch-action: none; font-family: 'Arial Black', sans-serif; }
        canvas { display: block; background: linear-gradient(to bottom, #101525 0%, #000 100%); }
        #ui { position: fixed; top: 15px; right: 15px; z-index: 100; pointer-events: auto; }
        .m-btn { padding: 10px 20px; background: #333; color: #fff; border: 1px solid #555; cursor: pointer; border-radius: 4px; }
    </style>
</head>
<body>

<canvas id="battleCanvas"></canvas>
<div id="ui"><button class="m-btn" onclick="toggleMenu()">МЕНЮ</button></div>

<script>
const canvas = document.getElementById('battleCanvas');
const ctx = canvas.getContext('2d');
let W, H;

const vehicles = [], planes = [], bombs = [], explosions = [];

class Tank {
    constructor(y, speed, scale, color, type) {
        this.x = -200 - Math.random() * 500;
        this.y = y; this.speed = speed; this.scale = scale; this.color = color;
        this.wAngle = 0;
    }

    update() {
        this.x += this.speed;
        this.wAngle += this.speed * 0.15;
        if(this.x > W + 200) this.x = -200;
    }

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.scale(this.scale, this.scale);
        
        // --- ХОДОВАЯ ЧАСТЬ ---
        ctx.fillStyle = '#1a1a1a';
        // Траки
        ctx.beginPath(); ctx.roundRect(-45, 8, 90, 18, 4); ctx.fill();
        // Ведущие колеса и катки
        ctx.fillStyle = '#333';
        for(let i = -35; i <= 35; i += 14) {
            ctx.save();
            ctx.translate(i, 18);
            ctx.rotate(this.wAngle);
            ctx.beginPath(); ctx.arc(0, 0, 6, 0, 7); ctx.fill();
            ctx.strokeStyle = '#000'; ctx.strokeRect(-2, -6, 4, 12); // Детали катка
            ctx.restore();
        }

        // --- КОРПУС ---
        ctx.fillStyle = this.color;
        ctx.strokeStyle = '#111'; ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.moveTo(-45, 10); ctx.lineTo(-40, -5); ctx.lineTo(35, -5); ctx.lineTo(45, 10);
        ctx.closePath(); ctx.fill(); ctx.stroke();
        // Надгусеничные полки
        ctx.fillStyle = 'rgba(0,0,0,0.3)'; ctx.fillRect(-45, 5, 90, 3);

        // --- БАШНЯ ---
        ctx.save();
        ctx.translate(-5, -5); // Смещение башни
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.moveTo(-20, 0); ctx.lineTo(-15, -12); ctx.lineTo(15, -12); ctx.lineTo(22, 0);
        ctx.closePath(); ctx.fill(); ctx.stroke();
        // Командирская башенка
        ctx.fillRect(-8, -16, 10, 5);
        // Маска орудия и ствол
        ctx.fillStyle = '#111';
        ctx.fillRect(18, -8, 8, 10); // Маска
        ctx.fillRect(25, -6, 45, 4); // Ствол
        ctx.fillRect(65, -8, 6, 8);  // Дульный тормоз
        ctx.restore();

        ctx.restore();
    }
}

class Plane {
    constructor(y, speed, type, scale) {
        this.x = W + 400; this.y = y; this.speed = speed; this.type = type; this.scale = scale;
        this.angle = 0; this.timer = Math.random() * 20;
    }
    update() {
        this.x -= this.speed;
        this.timer += 0.03;
        if(this.type === 'fighter') {
            let d = Math.sin(this.timer);
            this.y += d * 1.5; this.angle = d * 0.2;
        } else if(Math.floor(this.timer*10)%90 === 0) {
            bombs.push({x:this.x, y:this.y+10, vy:1, s:this.scale});
        }
        if(this.x < -400) this.x = W + 400;
    }
    draw() {
        ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(this.angle); ctx.scale(this.scale, this.scale);
        ctx.fillStyle = '#3e4432'; ctx.strokeStyle = '#000';
        ctx.beginPath(); // Упрощенный силуэт Ju-52/Hs-129
        ctx.ellipse(0,0, 50, 12, 0, 0, 7); ctx.fill(); ctx.stroke();
        ctx.fillRect(-10, -40, 15, 80); // Крыло
        ctx.restore();
    }
}

class Explosion {
    constructor(x, y, s) { this.x = x; this.y = y; this.s = s; this.life = 1.0; }
    draw() {
        ctx.save(); ctx.globalAlpha = this.life;
        let r = (1 - this.life) * 70 * this.s;
        ctx.fillStyle = this.life > 0.4 ? '#ffcc00' : '#444';
        ctx.beginPath(); ctx.arc(this.x, this.y, r, 0, 7); ctx.fill();
        ctx.restore(); this.life -= 0.03;
    }
}

function resize() {
    W = window.innerWidth; H = window.innerHeight;
    canvas.width = W; canvas.height = H;
    vehicles.length = 0; planes.length = 0;
    // Танки: дальний и ближний планы
    vehicles.push(new Tank(H - 120, 1.2, 0.75, '#435a3d'));
    vehicles.push(new Tank(H - 50, 1.8, 1.2, '#2e7d32'));
    // Самолеты
    planes.push(new Plane(H * 0.2, 3.5, 'bomber', 1.1));
    planes.push(new Plane(H * 0.4, 7, 'fighter', 0.8));
}

function loop() {
    ctx.clearRect(0, 0, W, H);
    // Дороги/Грунт
    ctx.fillStyle = 'rgba(255,255,255,0.05)';
    ctx.fillRect(0, H-135, W, 40); ctx.fillRect(0, H-65, W, 55);

    planes.forEach(p => { p.update(); p.draw(); });
    vehicles.forEach(v => { v.update(); v.draw(); });
    bombs.forEach((b, i) => {
        b.y += b.vy; b.vy += 0.12;
        ctx.fillStyle = '#000'; ctx.beginPath(); ctx.arc(b.x, b.y, 5, 0, 7); ctx.fill();
        let ground = b.s > 1 ? H - 55 : H - 125;
        if(b.y > ground) { explosions.push(new Explosion(b.x, b.y, b.s)); bombs.splice(i, 1); }
    });
    explosions.forEach((ex, i) => { ex.draw(); if(ex.life <= 0) explosions.splice(i, 1); });
    requestAnimationFrame(loop);
}

window.addEventListener('resize', resize);
resize(); loop();
</script>
</body>
</html>
