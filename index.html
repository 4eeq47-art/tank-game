<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ТАНКИ: БАТАЛИЯ (ГЕН-16)</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; font-family: 'Arial Black', sans-serif; }
        canvas { display: block; background: linear-gradient(to bottom, #141e30 0%, #000 100%); }
        
        /* Кнопка вызова меню */
        #menu-toggle {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            padding: 10px 20px; background: rgba(255,255,255,0.2); color: white;
            border: 2px solid white; border-radius: 5px; cursor: pointer; pointer-events: auto;
        }

        /* Скрытое меню */
        #menu-ui {
            position: fixed; inset: 0; z-index: 150;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.7);
        }
        .m-card { background: #ddd; padding: 20px; border-radius: 10px; width: 280px; text-align: center; }
        .btn { width: 100%; padding: 12px; margin: 5px 0; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .btn-start { background: #c62828; color: white; border: none; }
    </style>
</head>
<body>

<canvas id="battleCanvas"></canvas>
<button id="menu-toggle" onclick="toggleMenu()">МЕНЮ</button>

<div id="menu-ui" onclick="toggleMenu()">
    <div class="m-card" onclick="event.stopPropagation()">
        <h2 style="margin:0 0 15px 0;">МЕНЮ</h2>
        <button class="btn">1 VS 1</button>
        <button class="btn">ПРОТИВ БОТА</button>
        <button class="btn btn-start" onclick="toggleMenu()">ПРОДОЛЖИТЬ</button>
    </div>
</div>

<script>
const canvas = document.getElementById('battleCanvas');
const ctx = canvas.getContext('2d');
let W, H;

const vehicles = [], planes = [], bombs = [], bullets = [], particles = [], explosions = [];

class Plane {
    constructor(y, speed, type, zIndex) {
        this.y = y; this.speed = speed; this.type = type; this.zIndex = zIndex; // zIndex для масштаба взрывов
        this.x = W + 500; this.timer = Math.random() * 10;
        this.angle = 0;
    }
    update() {
        this.x -= this.speed;
        this.timer += 0.03;

        if(this.type === 'fighter') {
            let dive = Math.sin(this.timer);
            this.y += dive * 2;
            this.angle = dive * 0.2;
            // Выстрел из носа
            if(dive > 0.6 && Math.random() < 0.2) {
                bullets.push({x: this.x - 50, y: this.y + 5, angle: this.angle, v: 20, life: 40});
            }
        } else if(Math.floor(this.timer*10) % 80 === 0) {
            bombs.push({x: this.x, y: this.y + 10, vy: 1, z: this.zIndex});
        }

        if(this.x < -500) this.x = W + 500;
    }
    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.angle);
        ctx.fillStyle = this.type === 'bomber' ? '#3d4432' : '#4b5320';
        ctx.beginPath();
        ctx.ellipse(0, 0, this.type === 'bomber'?60:40, this.type === 'bomber'?15:8, 0, 0, 7);
        ctx.fill(); ctx.stroke();
        // Крылья
        ctx.fillRect(-10, -40, 20, 80);
        ctx.restore();
    }
}

class Explosion {
    constructor(x, y, scale) {
        this.x = x; this.y = y; this.scale = scale;
        this.life = 1.0;
    }
    draw() {
        ctx.save();
        ctx.globalAlpha = this.life;
        let r = (1 - this.life) * 50 * this.scale;
        let grad = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, r);
        grad.addColorStop(0, '#fff');
        grad.addColorStop(0.3, '#ff9800');
        grad.addColorStop(1, 'transparent');
        ctx.fillStyle = grad;
        ctx.beginPath(); ctx.arc(this.x, this.y, r, 0, 7); ctx.fill();
        ctx.restore();
        this.life -= 0.04;
    }
}

function resize() {
    W = window.innerWidth; H = window.innerHeight;
    canvas.width = W; canvas.height = H;
    vehicles.length = 0; planes.length = 0;
    // Танки на разном удалении
    vehicles.push({x:100, y:H-60, s:1.2, speed:2, color:'#2e7d32'}); // Близко
    vehicles.push({x:300, y:H-130, s:0.7, speed:1.2, color:'#435a3d'}); // Далеко
    
    planes.push(new Plane(H*0.2, 4, 'bomber', 0.6)); // Дальний самолет
    planes.push(new Plane(H*0.4, 7, 'fighter', 1.0)); // Ближний
}

function loop() {
    ctx.clearRect(0,0,W,H);
    
    // Рисуем технику
    planes.forEach(p => { p.update(); p.draw(); });
    vehicles.forEach(v => {
        v.x += v.speed; if(v.x > W+100) v.x = -100;
        ctx.fillStyle = v.color;
        ctx.fillRect(v.x-30*v.s, v.y, 60*v.s, 20*v.s);
        ctx.beginPath(); ctx.arc(v.x, v.y, 15*v.s, Math.PI, 0); ctx.fill();
    });

    // Пули
    bullets.forEach((b, i) => {
        ctx.strokeStyle = '#ff0'; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.moveTo(b.x, b.y);
        b.x -= Math.cos(b.angle) * b.v; b.y -= Math.sin(b.angle) * b.v;
        ctx.lineTo(b.x, b.y); ctx.stroke();
        if(b.life-- < 0) bullets.splice(i,1);
    });

    // Бомбы и взрывы
    bombs.forEach((b, i) => {
        b.y += b.vy; b.vy += 0.1;
        ctx.fillStyle = '#000'; ctx.beginPath(); ctx.arc(b.x, b.y, 4, 0, 7); ctx.fill();
        let groundY = b.z < 1.0 ? H-130 : H-60; // Разная высота земли для параллакса
        if(b.y > groundY) {
            explosions.push(new Explosion(b.x, b.y, b.z));
            bombs.splice(i, 1);
        }
    });

    explosions.forEach((ex, i) => {
        ex.draw();
        if(ex.life <= 0) explosions.splice(i, 1);
    });

    requestAnimationFrame(loop);
}

function toggleMenu() {
    const m = document.getElementById('menu-ui');
    m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
}

window.addEventListener('resize', resize);
resize(); loop();
</script>
</body>
</html>
