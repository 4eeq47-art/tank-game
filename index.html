<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ТАНКИ: МРАЧНОЕ НЕБО (ГЕН-13)</title>
    <style>
        body { margin: 0; background: #1a1a1a; overflow: hidden; touch-action: none; font-family: 'Courier New', monospace; }
        canvas { display: block; background: linear-gradient(to bottom, #2c3e50 0%, #000000 100%); }
        
        #menu-ui {
            position: fixed; inset: 0; z-index: 20;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.4);
        }
        .m-card { background: rgba(238, 238, 238, 0.9); padding: 25px; border: 4px solid #333; border-radius: 10px; width: 300px; text-align: center; }
        .btn { width: 100%; padding: 12px; margin: 8px 0; font-size: 16px; font-weight: 900; cursor: pointer; border: 3px solid #000; transition: 0.2s; text-transform: uppercase; }
        .btn-mode { background: #555; color: #fff; }
        .btn-mode.active { background: #2e7d32; border-color: #aeea00; }
        .btn-start { background: #c62828; color: #fff; font-size: 22px; margin-top: 15px; }
        .btn:active { transform: scale(0.95); }
        
        #gen-info { position: absolute; top: 10px; left: 10px; color: #aaa; font-size: 10px; pointer-events: none; }
    </style>
</head>
<body>

<div id="gen-info">GEN: 13 | PORTRAIT | ATMOSPHERIC</div>
<canvas id="menuCanvas"></canvas>

<div id="menu-ui">
    <div class="m-card">
        <h2 style="margin: 0 0 15px 0; color: #111;">БРОНЕТАНКИ</h2>
        <button class="btn btn-mode active" id="pvp">ИГРОК VS ИГРОК</button>
        <button class="btn btn-mode" id="pve">ИГРОК VS БОТ</button>
        <button class="btn btn-start" onclick="alert('Загрузка боя...')">В БОЙ!</button>
    </div>
</div>

<script>
const canvas = document.getElementById('menuCanvas');
const ctx = canvas.getContext('2d');
let W, H, audioCtx;

const vehicles = [], planes = [], bombs = [], bullets = [];

class Tank {
    constructor(y, speed, scale, color) {
        this.y = y; this.speed = speed; this.scale = scale; this.color = color;
        this.x = -200 - Math.random() * 500;
        this.wAngle = 0;
    }
    update() {
        this.x += this.speed;
        this.wAngle += this.speed * 0.15;
        if(this.x > W + 200) this.x = -200;
    }
    draw() {
        ctx.save(); ctx.translate(this.x, this.y); ctx.scale(this.scale, this.scale);
        // Гусеницы
        ctx.fillStyle = '#111'; ctx.beginPath(); ctx.roundRect(-42, 12, 84, 16, 4); ctx.fill();
        // Вращающиеся катки
        ctx.fillStyle = '#333';
        for(let i=-32; i<=32; i+=16) {
            ctx.save(); ctx.translate(i, 20); ctx.rotate(this.wAngle); ctx.fillRect(-4, -4, 8, 8); ctx.restore();
        }
        // Корпус
        ctx.fillStyle = this.color; ctx.strokeStyle = '#000'; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.roundRect(-38, -8, 76, 24, 3); ctx.fill(); ctx.stroke();
        // Башня
        ctx.beginPath(); ctx.arc(0, -8, 16, Math.PI, 0); ctx.fill(); ctx.stroke();
        ctx.fillStyle = '#000'; ctx.fillRect(8, -16, 40, 7); // Ствол
        ctx.restore();
    }
}

class Plane {
    constructor(y, speed, type) {
        this.baseY = y; this.y = y; this.speed = speed; this.type = type;
        this.x = W + 300; this.timer = Math.random() * 100;
        this.angle = 0;
    }
    update() {
        this.x -= this.speed;
        this.timer += 0.03;

        if(this.type === 'fighter') {
            // Маневр пикирования
            let dive = Math.sin(this.timer);
            this.y = this.baseY + dive * 50;
            this.angle = dive * 0.3;
            // Стрельба в нижней точке
            if(dive > 0.8 && Math.random() < 0.2) {
                bullets.push({x: this.x - 30, y: this.y + 10, vx: -15, vy: 10, l: 20});
                playSnd(400, 'square', 0.05, 0.02);
            }
        }

        if(this.type === 'bomber' && Math.floor(this.timer*10) % 50 === 0) {
            bombs.push({x: this.x, y: this.y + 20, vy: 1});
            playSnd(300, 'sine', 1.0, 0.03, 50);
        }

        if(this.x < -300) { this.x = W + 300; this.baseY = H * (0.1 + Math.random() * 0.35); }
    }
    draw() {
        ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(this.angle);
        let s = (this.type === 'bomber') ? 1.2 : 0.8;
        ctx.scale(s, s);

        // Крылья
        ctx.fillStyle = '#3e4a36';
        ctx.beginPath(); ctx.ellipse(0, 0, 15, 60, 0, 0, 7); ctx.fill();
        // Фюзеляж
        ctx.fillStyle = '#4b5320'; ctx.strokeStyle = '#000';
        ctx.beginPath(); ctx.ellipse(0, 5, 60, 15, 0, 0, 7); ctx.fill(); ctx.stroke();
        // Кабина
        ctx.fillStyle = 'rgba(135, 206, 235, 0.5)';
        ctx.beginPath(); ctx.ellipse(20, 0, 15, 8, 0, 0, 7); ctx.fill();
        ctx.restore();
    }
}

function playSnd(f, t, d, v, s) {
    if(!audioCtx) return;
    try {
        const o = audioCtx.createOscillator(), g = audioCtx.createGain();
        o.type = t; o.frequency.setValueAtTime(f, audioCtx.currentTime);
        if(s) o.frequency.exponentialRampToValueAtTime(s, audioCtx.currentTime + d);
        g.gain.setValueAtTime(v, audioCtx.currentTime);
        g.gain.linearRampToValueAtTime(0, audioCtx.currentTime + d);
        o.connect(g); g.connect(audioCtx.destination);
        o.start(); o.stop(audioCtx.currentTime + d);
    } catch(e){}
}

function resize() {
    W = window.innerWidth; H = window.innerHeight;
    canvas.width = W; canvas.height = H;
    vehicles.length = 0; planes.length = 0;
    vehicles.push(new Tank(H - 80, 2.2, 1.2, '#2e7d32'));
    vehicles.push(new Tank(H - 160, 1.5, 0.85, '#4b5320'));
    planes.push(new Plane(H * 0.2, 5, 'bomber'));
    planes.push(new Plane(H * 0.4, 8, 'fighter'));
}

function loop() {
    ctx.clearRect(0, 0, W, H);
    
    // Отрисовка облаков (просто пятна для атмосферы)
    ctx.fillStyle = 'rgba(255,255,255,0.05)';
    for(let i=0; i<5; i++) { ctx.beginPath(); ctx.arc((Date.now()*0.02 + i*300)%W, 100+i*50, 100, 0, 7); ctx.fill(); }

    planes.forEach(p => { p.update(); p.draw(); });
    vehicles.forEach(v => { v.update(); v.draw(); });

    bombs.forEach((b, i) => {
        b.y += b.vy; b.vy += 0.12;
        ctx.fillStyle = '#000'; ctx.beginPath(); ctx.arc(b.x, b.y, 6, 0, 7); ctx.fill();
        if(b.y > H - 40) { playSnd(60, 'sawtooth', 0.3, 0.05); bombs.splice(i,1); }
    });

    bullets.forEach((p, i) => {
        ctx.strokeStyle = '#ffff00'; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p.x + p.vx, p.y + p.vy); ctx.stroke();
        p.x += p.vx; p.y += p.vy; p.l--;
        if(p.l <= 0) bullets.splice(i, 1);
    });

    requestAnimationFrame(loop);
}

// Логика кнопок
document.querySelectorAll('.btn-mode').forEach(btn => {
    btn.onclick = () => {
        document.querySelectorAll('.btn-mode').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    };
});

window.addEventListener('resize', resize);
resize(); loop();
</script>
</body>
</html>
