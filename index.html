<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>БРОНЕТАНКИ: ГЕНЕРАЦИЯ 10</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: #333; overflow: hidden; touch-action: none; font-family: 'Courier New', monospace; }
        canvas { display: block; position: absolute; inset: 0; }
        #gameCanvas { z-index: 5; display: none; background: #444; }
        
        /* Главное меню */
        #menu { position: fixed; inset: 0; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); }
        .m-card { background: #eee; padding: 25px; border: 5px solid #000; border-radius: 15px; text-align: center; width: 340px; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .btn { width: 100%; padding: 15px; margin: 8px 0; font-size: 18px; font-weight: 900; cursor: pointer; border: 3px solid #000; border-radius: 10px; text-transform: uppercase; }
        .btn-start { background: #c62828; color: #fff; font-size: 24px; }
        .btn-dev { background: #ff9800; color: #000; font-size: 14px; }
        .btn-mode { background: #444; color: #fff; }
        .btn-mode.active { background: #2e7d32; border-color: #aeea00; }

        /* Панель разработчика (выплывающая) */
        #dev-overlay { display: none; position: fixed; inset: 0; z-index: 110; background: #222; color: #fff; padding: 20px; overflow-y: auto; }
        .dev-title { color: #ff9800; text-align: center; border-bottom: 2px solid #444; padding-bottom: 10px; }
        .dev-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .dev-opt { padding: 12px; background: #333; border: 1px solid #555; text-align: center; font-size: 11px; cursor: pointer; border-radius: 5px; }
        .dev-opt.active { background: #2e7d32; border-color: #fff; font-weight: bold; }

        #ui { position: fixed; inset: 0; z-index: 10; pointer-events: none; display: none; }
        .score { position: absolute; width: 100%; text-align: center; font-weight: 900; color: #fff; font-size: 24px; }
        #exit-btn { position: fixed; right: 10px; top: 50%; transform: translateY(-50%) rotate(90deg); z-index: 200; padding: 10px 20px; background: #000; color: #fff; border: 2px solid #fff; font-weight: bold; display: none; }
        #gen-num { position: absolute; top: 15px; left: 15px; color: #fff; opacity: 0.7; font-size: 14px; }
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="menu">
    <div id="gen-num">ГЕНЕРАЦИЯ: 10</div>
    <div class="m-card">
        <h1 style="margin: 0 0 20px 0; color: #222;">БРОНЕТАНКИ</h1>
        
        <button class="btn btn-mode active" id="pvp-btn" onclick="setMode('pvp')">ИГРОК VS ИГРОК</button>
        <button class="btn btn-mode" id="pve-btn" onclick="setMode('pve')">ИГРОК VS БОТ</button>
        
        <button class="btn btn-start" onclick="startGame()">В БОЙ!</button>
        
        <button class="btn btn-dev" onclick="toggleDev(true)">Настройки (DEV MODE)</button>
    </div>
</div>

<div id="dev-overlay">
    <h2 class="dev-title">АРХИВ ГЕНЕРАЦИЙ</h2>
    
    <p>МОДЕЛЬ ТАНКА:</p>
    <div class="dev-grid" id="tank-opts">
        <div class="dev-opt" onclick="setCfg('tank','alpha')">ALPHA (КВАДРАТ)</div>
        <div class="dev-opt" onclick="setCfg('tank','beta')">BETA (+HP)</div>
        <div class="dev-opt active" onclick="setCfg('tank','final')">FINAL (+ВСПЫШКА)</div>
    </div>

    <p>ТИП УКРЫТИЙ:</p>
    <div class="dev-grid" id="wall-opts">
        <div class="dev-opt" onclick="setCfg('wall','walls')">ПЕРВЫЕ СТЕНЫ</div>
        <div class="dev-opt" onclick="setCfg('wall','back')">ГЕН 4 (ТЫЛ)</div>
        <div class="dev-opt active" onclick="setCfg('wall','front')">ГЕН 6 (ДУЛО)</div>
        <div class="dev-opt" onclick="setCfg('wall','bastion')">ГЕН 7 (БАСТИОН)</div>
    </div>

    <p>СТИЛЬ ИНТЕРФЕЙСА:</p>
    <div class="dev-grid" id="ui-opts">
        <div class="dev-opt" onclick="setCfg('ui','corner')">УГЛОВОЙ (OLD)</div>
        <div class="dev-opt active" onclick="setCfg('ui','center')">ЦЕНТР (NEW)</div>
    </div>

    <button class="btn btn-start" onclick="toggleDev(false)">ПРИМЕНИТЬ</button>
</div>

<div id="ui">
    <div id="score2" class="score">0</div>
    <div id="score1" class="score">0</div>
</div>

<button id="exit-btn" onclick="location.reload()">В МЕНЮ</button>

<script>
let cfg = { tank: 'final', wall: 'front', ui: 'center', mode: 'pvp' };
const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');
let W, H, isGame = false, tanks = [], bricks = [];

function setMode(m) {
    cfg.mode = m;
    document.getElementById('pvp-btn').classList.toggle('active', m === 'pvp');
    document.getElementById('pve-btn').classList.toggle('active', m === 'pve');
}

function toggleDev(show) {
    document.getElementById('dev-overlay').style.display = show ? 'block' : 'none';
}

function setCfg(type, val) {
    cfg[type] = val;
    const btns = document.querySelectorAll(`#${type}-opts .dev-opt`);
    btns.forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
}

function drawTank(t) {
    ctx.save(); ctx.translate(t.x, t.y);
    
    // HP (кроме Alpha)
    if(cfg.tank !== 'alpha') {
        ctx.fillStyle = '#000'; ctx.fillRect(t.isBottom?40:-45, -20, 5, 40);
        ctx.fillStyle = t.id===0?'#69f0ae':'#ff5252';
        ctx.fillRect(t.isBottom?40:-45, -20 + (40*(1-t.hp/3)), 5, 40*(t.hp/3));
    }

    ctx.rotate(t.angle);
    
    if(cfg.tank === 'final') {
        ctx.fillStyle = '#111'; ctx.fillRect(-28,-22,56,12); ctx.fillRect(-28,10,56,12);
        ctx.fillStyle = t.color; ctx.strokeStyle = '#000'; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.roundRect(-24,-18,48,36,4); ctx.fill(); ctx.stroke();
        ctx.beginPath(); ctx.arc(0,0,16,0,7); ctx.fill(); ctx.stroke();
        ctx.fillStyle = '#111'; ctx.fillRect(14,-4,35,8);
        if(t.flash > 0) {
            let g = ctx.createRadialGradient(60, 0, 0, 60, 0, 25);
            g.addColorStop(0, '#fff'); g.addColorStop(1, 'transparent');
            ctx.fillStyle = g; ctx.beginPath(); ctx.arc(60,0,25,0,7); ctx.fill();
            t.flash--;
        }
    } else {
        ctx.fillStyle = t.color; ctx.fillRect(-20,-20,40,40);
        ctx.fillStyle = '#000'; ctx.fillRect(10,-5,25,10);
    }
    ctx.restore();
}

function createWalls() {
    bricks = []; let cx = W/2 - 75;
    const r = (x,y,w,h) => { for(let i=0; i<w; i++) for(let j=0; j<h; j++) bricks.push({x:x+i*26, y:y+j*16}); };
    
    switch(cfg.wall) {
        case 'walls': r(60, H/2-60, 2, 8); r(W-110, H/2-60, 2, 8); break;
        case 'back': r(cx, 150, 6, 1); r(cx, 100, 1, 4); r(cx+130, 100, 1, 4); break;
        case 'front': r(cx, 250, 6, 1); r(cx, 200, 1, 4); r(cx+130, 200, 1, 4); break;
        case 'bastion': r(cx, 250, 6, 2); r(cx, 200, 1, 4); r(cx+130, 200, 1, 4); break;
    }
}

function startGame() {
    W = window.innerWidth; H = window.innerHeight;
    canvas.width = W; canvas.height = H;
    document.getElementById('menu').style.display = 'none';
    document.getElementById('ui').style.display = 'block';
    document.getElementById('exit-btn').style.display = 'block';
    canvas.style.display = 'block';
    
    tanks = [{x:W/2, y:H-100, angle:-Math.PI/2, color:'#2e7d32', hp:3, flash:0, id:0, isBottom:true}];
    createWalls();
    
    const s1 = document.getElementById('score1'), s2 = document.getElementById('score2');
    if(cfg.ui === 'center') {
        s1.style.cssText = "bottom: 140px; font-size: 24px;";
        s2.style.cssText = "top: 120px; font-size: 24px; transform: rotate(180deg);";
    } else {
        s1.style.cssText = "bottom: 20px; left: 20px; width: auto; font-size: 32px;";
        s2.style.cssText = "top: 20px; right: 20px; width: auto; font-size: 32px;";
    }
    
    isGame = true;
    update();
}

function update() {
    if(!isGame) return;
    ctx.clearRect(0,0,W,H);
    bricks.forEach(b => { ctx.fillStyle = '#8d4925'; ctx.fillRect(b.x, b.y, 25, 15); ctx.strokeRect(b.x, b.y, 25, 15); });
    tanks.forEach(drawTank);
    requestAnimationFrame(update);
}

// Эмуляция огня для теста
window.addEventListener('touchstart', (e) => { if(isGame) tanks[0].flash = 8; });
</script>
</body>
</html>
