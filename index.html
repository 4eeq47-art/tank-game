<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tanks Final</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; font-family: sans-serif; }
        canvas { display: block; background: #111; }
        .ui { position: absolute; width: 100%; color: white; display: flex; justify-content: space-around; top: 45%; pointer-events: none; z-index: 100; font-size: 20px; text-shadow: 2px 2px 2px #000; }
        .controls { position: absolute; inset: 0; pointer-events: none; z-index: 200; }
        .btn { position: absolute; width: 70px; height: 70px; background: rgba(255,255,255,0.2); border: 3px solid #fff; border-radius: 15px; pointer-events: auto; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px; }
        .fire { width: 100px; height: 100px; border-radius: 50%; font-size: 18px; font-weight: bold; }
        
        /* Игрок 1 (Зеленый) - СНИЗУ */
        #p1-u { bottom: 170px; left: 90px; }
        #p1-d { bottom: 30px; left: 90px; }
        #p1-l { bottom: 100px; left: 20px; }
        #p1-r { bottom: 100px; left: 160px; }
        #p1-f { bottom: 80px; right: 50px; background: rgba(0,255,0,0.4); border-color: #0f0; }
        
        /* Игрок 2 (Красный) - СВЕРХУ */
        #p2-u { top: 170px; right: 90px; transform: rotate(180deg); }
        #p2-d { top: 30px; right: 90px; transform: rotate(180deg); }
        #p2-l { top: 100px; right: 160px; transform: rotate(180deg); }
        #p2-r { top: 100px; right: 20px; transform: rotate(180deg); }
        #p2-f { top: 80px; left: 50px; background: rgba(255,0,0,0.4); border-color: #f00; transform: rotate(180deg); }
    </style>
</head>
<body>
    <div class="ui"><span id="s2">Красный: 0</span><span id="s1">Зеленый: 0</span></div>
    <canvas id="g"></canvas>
    <div class="controls">
        <div class="btn" id="p1-u">▲</div><div class="btn" id="p1-d">▼</div>
        <div class="btn" id="p1-l">◀</div><div class="btn" id="p1-r">▶</div>
        <div class="btn fire" id="p1-f">ОГОНЬ</div>
        <div class="btn" id="p2-u">▲</div><div class="btn" id="p2-d">▼</div>
        <div class="btn" id="p2-l">◀</div><div class="btn" id="p2-r">▶</div>
        <div class="btn fire" id="p2-f">ОГОНЬ</div>
    </div>
<script>
const cvs = document.getElementById('g'); const ctx = cvs.getContext('2d');
cvs.width = window.innerWidth; cvs.height = window.innerHeight;
let bullets = [];
let tanks = [
    { x: cvs.width/2, y: cvs.height-100, c: 'green', a: -Math.PI/2, s: 0 },
    { x: cvs.width/2, y: 100, c: 'red', a: Math.PI/2, s: 0 }
];
function draw() {
    ctx.fillStyle = '#111'; ctx.fillRect(0,0,cvs.width,cvs.height);
    tanks.forEach(t => {
        ctx.save(); ctx.translate(t.x, t.y); ctx.rotate(t.a);
        ctx.fillStyle = t.c; ctx.fillRect(-25,-20,50,40); // Танк стал крупнее
        ctx.fillStyle = '#999'; ctx.fillRect(15,-5,30,10); ctx.restore(); // Дуло
    });
    bullets.forEach((b, i) => {
        b.x += Math.cos(b.a) * 8; b.y += Math.sin(b.a) * 8;
        ctx.fillStyle = 'yellow'; ctx.beginPath(); ctx.arc(b.x,b.y,5,0,7); ctx.fill();
        tanks.forEach((t, ti) => {
            if(Math.hypot(b.x-t.x, b.y-t.y) < 30) {
                tanks[ti===0?1:0].s++;
                document.getElementById('s'+(ti===0?2:1)).innerText = (ti===0?'Красный: ':'Зеленый: ') + tanks[ti===0?1:0].s;
                t.x = cvs.width/2; t.y = ti===0?cvs.height-100:100; bullets.splice(i, 1);
            }
        });
        if(b.x<0||b.x>cvs.width||b.y<0||b.y>cvs.height) bullets.splice(i,1);
    });
    requestAnimationFrame(draw);
}
const move = (i, nx, ny, angle) => { 
    tanks[i].x += nx * 10; tanks[i].y += ny * 10; tanks[i].a = angle; 
};
const bind = (id, f) => {
    const el = document.getElementById(id);
    el.ontouchstart = (e) => { e.preventDefault(); f(); el.style.background = '#fff'; };
    el.ontouchend = () => { el.style.background = ''; };
};
// Игрок 1 (Зеленый)
bind('p1-u', ()=>move(0,0,-1,-Math.PI/2)); bind('p1-d', ()=>move(0,0,1,Math.PI/2));
bind('p1-l', ()=>move(0,-1,0,Math.PI)); bind('p1-r', ()=>move(0,1,0,0));
bind('p1-f', ()=>{ bullets.push({x:tanks[0].x, y:tanks[0].y, a:tanks[0].a}); });
// Игрок 2 (Красный)
bind('p2-u', ()=>move(1,0,1,Math.PI/2)); bind('p2-d', ()=>move(1,0,-1,-Math.PI/2));
bind('p2-l', ()=>move(1,1,0,0)); bind('p2-r', ()=>move(1,-1,0,Math.PI));
bind('p2-f', ()=>{ bullets.push({x:tanks[1].x, y:tanks[1].y, a:tanks[1].a}); });
draw();
</script>
</body>
</html>
