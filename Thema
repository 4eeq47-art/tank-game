<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ТАНКИ: ВЕРТИКАЛЬНЫЙ ПАРАД</title>
    <style>
        body { margin: 0; background: #4d4d4d; overflow: hidden; touch-action: none; font-family: 'Arial Black', sans-serif; }
        canvas { display: block; background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 100%); }
        #ui {
            position: fixed; inset: 0; z-index: 10;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            padding-bottom: 80px; pointer-events: none;
        }
        .title-block { position: absolute; top: 15%; text-align: center; width: 100%; }
        .title { color: white; font-size: 12vw; text-shadow: 4px 4px 0 #2e7d32; margin: 0; text-transform: uppercase; }
        .gen-num { color: #111; font-size: 14px; opacity: 0.6; }
        .btn-start {
            padding: 25px 80px; font-size: 28px; background: #c62828; color: white;
            border: 6px solid #fff; border-radius: 15px; cursor: pointer; pointer-events: auto;
            box-shadow: 0 10px 0 #8e0000; transition: 0.1s;
        }
        .btn-start:active { transform: translateY(5px); box-shadow: 0 5px 0 #8e0000; }
    </style>
</head>
<body>

<canvas id="menuCanvas"></canvas>

<div id="ui">
    <div class="title-block">
        <h1 class="title">ТАНКИ</h1>
        <div class="gen-num">ГЕНЕРАЦИЯ №12 (PORTRAIT)</div>
    </div>
    <button class="btn-start" onclick="initAudio()">В БОЙ</button>
</div>

<script>
const canvas = document.getElementById('menuCanvas');
const ctx = canvas.getContext('2d');
let W, H, audioCtx;

const vehicles = [], planes = [], bombs = [], fx = [];

class Tank {
    constructor(y, speed, scale, color) {
        this.y = y; this.speed = speed; this.scale = scale; this.color = color;
        this.x = -150 - Math.random() * 400;
        this.wAngle = 0;
    }
    update() {
        this.x += this.speed;
        this.wAngle += this.speed * 0.15;
        if(this.x > W + 150) this.x = -150;
    }
    draw() {
        ctx.save(); ctx.translate(this.x, this.y); ctx.scale(this.scale, this.scale);
        // Гусеницы
        ctx.fillStyle = '#222'; ctx.beginPath(); ctx.roundRect(-40, 10, 80, 15, 5); ctx.fill();
        // Катки (вращение)
        ctx.fillStyle = '#555';
        for(let i=-30; i<=30; i+=15) {
            ctx.save(); ctx.translate(i, 18); ctx.rotate(this.wAngle); ctx.fillRect(-4, -4, 8, 8); ctx.restore();
        }
        // Корпус и дуло
        ctx.fillStyle = this.color; ctx.strokeStyle = '#000'; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.roundRect(-35, -10, 70, 22, 4); ctx.fill(); ctx.stroke();
        ctx.beginPath(); ctx.arc(0, -10, 14, Math.PI, 0); ctx.fill(); ctx.stroke();
        ctx.fillStyle = '#111'; ctx.fillRect(5, -18, 35, 6);
        ctx.restore();
    }
}

class Plane {
    constructor(y, speed, scale, type) {
        this.y = y; this.speed = speed; this.scale = scale; this.type = type;
        this.x = W + 200; this.timer = 0;
    }
    update() {
        this.x -= this.speed; this.timer++;
        if(this.x < -200) { this.x = W + 200; this.y = H * (0.1 + Math.random() * 0.4); }
        if(this.type === 'bomber' && this.timer % 180 === 0) {
            bombs.push({x: this.x, y: this.y + 20, vy: 1});
            playSnd(250, 'sine', 1.2, 0.05, 60);
        }
        if(this.type === 'fighter' && this.timer % 120 === 0) {
            fx.push({x: this.x-20, y: this.y+10, vx: -12, vy: 8, l: 15});
        }
    }
    draw() {
        ctx.save(); ctx.translate(this.x, this.y); ctx.scale(this.scale, this.scale);
        ctx.fillStyle = '#4b5320'; // Крылья
        ctx.beginPath(); ctx.ellipse(0, 0, 12, 45, 0, 0, 7); ctx.fill();
        ctx.fillStyle = '#6b8e23'; ctx.strokeStyle = '#111';
        ctx.beginPath(); ctx.ellipse(0, 4, 45, 10, 0, 0, 7); ctx.fill(); ctx.stroke();
        ctx.restore();
    }
}

function playSnd(f, t, d, v, s) {
    if(!audioCtx) return;
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type = t; o.frequency.setValueAtTime(f, audioCtx.currentTime);
    if(s) o.frequency.exponentialRampToValueAtTime(s, audioCtx.currentTime + d);
    g.gain.setValueAtTime(v, audioCtx.currentTime);
    g.gain.linearRampToValueAtTime(0, audioCtx.currentTime + d);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime + d);
}

function resize() {
    W = window.innerWidth; H = window.innerHeight;
    canvas.width = W; canvas.height = H;
    vehicles.length = 0; planes.length = 0;
    // Размещение по вертикали
    vehicles.push(new Tank(H - 60, 2.5, 1.3, '#2e7d32'));
    vehicles.push(new Tank(H - 140, 1.8, 0.9, '#556b2f'));
    planes.push(new Plane(H * 0.15, 4, 1.2, 'bomber'));
    planes.push(new Plane(H * 0.35, 7, 0.8, 'fighter'));
}

function loop() {
    ctx.clearRect(0,0,W,H);
    // Дороги
    ctx.fillStyle = 'rgba(0,0,0,0.1)'; ctx.fillRect(0, H-150, W, 40); ctx.fillRect(0, H-70, W, 50);

    planes.forEach(p => { p.update(); p.draw(); });
    vehicles.forEach(v => { v.update(); v.draw(); });

    bombs.forEach((b, i) => {
        b.y += b.vy; b.vy += 0.15;
        ctx.fillStyle = '#111'; ctx.beginPath(); ctx.arc(b.x, b.y, 5, 0, 7); ctx.fill();
        if(b.y > H - 50) { 
            playSnd(80, 'sawtooth', 0.2, 0.1); bombs.splice(i, 1); 
        }
    });

    fx.forEach((p, i) => {
        ctx.strokeStyle = '#fff700'; ctx.lineWidth = 3;
        ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p.x + p.vx, p.y + p.vy); ctx.stroke();
        p.x += p.vx; p.y += p.vy; p.l--;
        if(p.l <= 0) fx.splice(i,1);
    });

    requestAnimationFrame(loop);
}

function initAudio() {
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    alert("Игра начинается!");
}

window.addEventListener('resize', resize);
resize();
loop();
</script>
</body>
</html>
